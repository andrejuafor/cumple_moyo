'use strict'

const {ConsultaLibre, Transaction, TransactionDetail, OfficeAccount} = require('loyalty-db')

// Estos procesos son para las pruebas del colegio aleman.

const cuentas80Saldo = [110001,110002,110003,110004,110005,110006,110007,110008,110009,110010,110011,110012,110013,110014,110015,110016,110017,110018,110019,110020,110021,110022,110023,110024,110025,110026,110027,110028,110029,110030,110031,110032,110033,110034,110035,110036,110037,110038,110039,110040,110041,110042,110043,110044,110045,110046,110047,110048,110049,110050,110051,110052,110053,110054,110055,110056,110057,110058,110059,110060,110061,110062,110063,110064,110065,110066,110067,110068,110069,110070,110071,110072,110073,110074,110075,110076,110077,110078,110079,110080,110081,110082,110083,110084,110085,110086,110087,110088,110089,110090,110091,110092,110093,110094,110095,110096,110097,110098,110099,110100,110101,110102,110103,110104,110105,110106,110107,110108,110109,110110,110111,110112,110113,110114,110115,110116,110117,110118,110119,110120,110121,110122,110123,110124,110125,110126,110127,110128,110129,110130,110131,110132,110133,110134,110135,110136,110137,110138,110139,110140,110141,110142,110143,110144,110145,110146,110147,110148,110149,110150,110151,110152,110153,110154,110155,110156,110157,110158,110159,110160,110161,110162,110163,110164,110165,110166,110167,110168,110169,110170,110171,110172,110173,110174,110175,110176,110177,110178,110179,110180,110181,110182,110183,110184,110185,110186,110187,110188,110189,110190,110191,110192,110193,110194,110195,110196,110197,110198,110199,110200,113701,113702,113704,113706,113708,113709,113710,113711,113712,113714,113715,113716,113717,113718,113719,113720,113722,113723,113724,113725,113726,113727,113728,113729,113730,113731,113732,113735,113737,113738,113739,113740,113742,113745,113746,113747,113748,113749,113750,113751,113752,113753,113754,113756,113757,113759,113760,113761,113762,113764,113765,113766,113767,113768,113769,113770,113771,113774,113776,113778,113779,113780,113781,113782,113785,113786,113787,113789,113791,113792,113793,113794,113795,113796,113799,113800,131001,131002,131003,131004,131005,131006,131007,131008,131009,131010,131011,131012,131013,131014,131015,131016,131017,131018,131019,131020,131021,131022,131023,131024,131025,131026,131027,131028,131029,131030,131031,131032,131033,131034,131035,131036,131037,131038,131039,131040,131041,131042,131043,131044,131045,131046,131047,131048,131049,131050,131051,131052,131053,131054,131055,131056,131057,131058,131059,131060,131061,131062,131063,131064,131065,131066,131067,131068,131069,131070,131071,131072,131073,131074,131075,131076,131077,131078,131079,131080,131081,131082,131083,131084,131085,131086,131087,131088,131089,131090,131091,131092,131093,131094,131095,131096,131097,131098,131099,131100,131101,131102,131103,131104,131105,131106,131107,131108,131109,131110,131111,131112,131113,131114,131115,131116,131117,131118,131119,131120,131121,131122,131123,131124,131125,131126,131127,131128,131129,131130,131131,131132,131133,131134,131135,131136,131137,131138,131139,131140,131141,131142,131143,131144,131145,131146,131147,131148,131149,131150,131151,131152,131153,131154,131155,131156,131157,131158,131159,131160,131161,131162,131163,131164,131165,131166,131167,131168,131169,131170,131171,131172,131173,131174,131175,131176,131177,131178,131179,131180,131181,131182,131183,131184,131185,131186,131187,131188,131189,131190,131191,131192,131193,131194,131195,131196,131197,131198,131199,131200,131201,131202,131203,131204,131205,131206,131207,131208,131209,131210,131211,131212,131213,131214,131215,131216,131217,131218,131219,131220,131221,131222,131223,131224,131225,131226,131227,131228,131229,131230,131231,131232,131233,131234,131235,131236,131237,131238,131239,131240,131241,131242,131243,131244,131245,131246,131247,131248,131249,131250]

const cuentas180Saldo = [110201,110202,110203,110204,110205,110206,110207,110208,110209,110210,110211,110212,110213,110214,110215,110216,110217,110218,110219,110220,110221,110222,110223,110224,110225,110226,110227,110228,110229,110230,110231,110232,110233,110234,110235,110236,110237,110238,110239,110240,110241,110242,110243,110244,110245,110246,110247,110248,110249,110250,110251,110252,110253,110254,110255,110256,110257,110258,110259,110260,110261,110262,110263,110264,110265,110266,110267,110268,110269,110270,110271,110272,110273,110274,110275,110276,110277,110278,110279,110280,110281,110282,110283,110284,110285,110286,110287,110288,110289,110290,110291,110292,110293,110294,110295,110296,110297,110298,110299,110300,110301,110302,110303,110304,110305,110306,110307,110308,110309,110310,110311,110312,110313,110314,110315,110316,110317,110318,110319,110320,110321,110322,110323,110324,110325,110326,110327,110328,110329,110330,110331,110332,110333,110334,110335,110336,110337,110338,110339,110340,110341,110342,110343,110344,110345,110346,110347,110348,110349,110350,110351,110352,110353,110354,110355,110356,110357,110358,110359,110360,110361,110362,110363,110364,110365,110366,110367,110368,110369,110370,110371,110372,110373,110374,110375,110376,110377,110378,110379,110380,110381,110382,110383,110384,110385,110386,110387,110388,110389,110390,110391,110392,110393,110394,110395,110396,110397,110398,110399,110400,111501,111502,111503,111504,111505,111506,111507,111508,111509,111510,111511,111512,111513,111514,111515,111516,111517,111518,111519,111520,111521,111522,111523,111524,111525,111526,111527,111528,111529,111530,111531,111532,111533,111534,111535,111536,111537,111538,111539,111540,111541,111542,111543,111544,111545,111546,111547,111548,111549,111550,111551,111552,111553,111554,111555,111556,111557,111558,111559,111560,111561,111562,111563,111564,111565,111566,111567,111568,111569,111570,111571,111572,111573,111574,111575,111576,111577,111578,111579,111580,111581,111582,111583,111584,111585,111586,111587,111588,111589,111590,111591,111592,111593,111594,111595,111596,111597,111598,111599,111600,111601,111602,111603,111604,111605,111606,111607,111608,111609,111610,111611,111612,111613,111614,111615,111616,111617,111618,111619,111620,111621,111622,111623,111624,111625,111626,111627,111628,111629,111630,111631,111632,111633,111634,111635,111636,111637,111638,111639,111640,111641,111642,111643,111644,111645,111646,111647,111648,111649,111650,111651,111652,111653,111654,111655,111656,111657,111658,111659,111660,111661,111662,111663,111664,111665,111666,111667,111668,111669,111670,111671,111672,111673,111674,111675,111676,111677,111678,111679,111680,111681,111682,111683,111684,111685,111686,111687,111688,111689,111690,111691,111692,111693,111694,111695,111696,111697,111698,111699,111700,113001,113002,113005,113006,113007,113008,113009,113011,113012,113013,113014,113015,113016,113017,113018,113019,113020,113022,113023,113025,113026,113027,113028,113029,113031,113032,113033,113035,113038,113041,113043,113046,113047,113049,113052,113054,113055,113057,113058,113059,113060,113061,113062,113063,113064,113067,113068,113069,113070,113071,113072,113073,113074,113078,113080,113081,113083,113084,113086,113090,113091,113092,113095,113096,113098,113099,113101,113103,113105,113106,113107,113108,113109,113111,113113,113115,113116,113117,113118,113120,113121,113122,113123,113124,113125,113128,113130,113131,113132,113133,113134,113136,113138,113140,113141,113143,113144,113145,113146,113147,113149,113150,113151,113153,113154,113155,113156,113159,113160,113161,113163,113164,113165,113166,113167,113168,113169,113170,113171,113172,113173,113175,113177,113178,113179,113180,113181,113183,113184,113185,113186,113187,113188,113189,113190,113191,113192,113193,113194,113195,113196,113197,113198,113199,113200,113301,113302,113303,113304,113305,113306,113307,113308,113309,113310,113311,113312,113313,113314,113315,113316,113317,113318,113319,113320,113321,113322,113323,113324,113325,113326,113327,113328,113329,113330,113331,113332,113333,113334,113335,113336,113337,113338,113339,113340,113341,113342,113343,113344,113345,113346,113347,113348,113349,113350,113351,113352,113353,113354,113355,113356,113357,113358,113359,113360,113361,113362,113363,113364,113365,113366,113367,113368,113369,113370,113371,113372,113373,113374,113375,113376,113377,113378,113379,113380,113381,113382,113383,113384,113385,113386,113387,113388,113389,113390,113391,113392,113393,113394,113395,113396,113397,113398,113399,113400,113401,113402,113403,113404,113405,113406,113407,113408,113409,113410,113411,113412,113413,113414,113415,113416,113417,113418,113419,113420,113421,113422,113423,113424,113425,113426,113427,113428,113429,113430,113431,113432,113433,113434,113435,113436,113437,113438,113439,113440,113441,113442,113443,113444,113445,113446,113447,113448,113449,113450,113451,113452,113453,113454,113455,113456,113457,113458,113459,113460,113461,113462,113463,113464,113465,113466,113467,113468,113469,113470,113471,113472,113473,113474,113475,113476,113477,113478,113479,113480,113481,113482,113483,113484,113485,113486,113487,113488,113489,113490,113491,113492,113493,113494,113495,113496,113497,113498,113499,113500,113501,113502,113504,113505,113508,113510,113511,113512,113513,113514,113516,113517,113518,113520,113521,113523,113524,113525,113526,113527,113528,113529,113532,113533,113535,113536,113537,113539,113541,113543,113545,113546,113547,113548,113549,113550,113551,113552,113553,113554,113555,113556,113557,113559,113562,113563,113564,113565,113569,113570,113571,113572,113574,113575,113576,113577,113581,113582,113583,113586,113588,113589,113590,113591,113592,113593,113595,113596,113801,113802,113804,113807,113808,113809,113812,113813,113814,113815,113816,113817,113820,113824,113825,113826,113829,113830,113831,113832,113833,113834,113835,113836,113838,113841,113843,113844,113845,113846,113847,113848,113849,113850,113851,113853,113854,113855,113856,113858,113860,113861,113862,113863,113864,113865,113866,113868,113869,113870,113871,113873,113874,113876,113878,113879,113881,113882,113883,113884,113885,113886,113887,113888,113889,113891,113892,113893,113894,113895,113896,113897,113898,113899,113900,113901,113902,113903,113906,113907,113908,113909,113910,113911,113912,113913,113914,113916,113917,113920,113922,113924,113925,113926,113927,113929,113930,113934,113935,113936,113937,113938,113939,113940,113942,113943,113944,113946,113947,113948,113949,113950,113951,113952,113954,113957,113958,113959,113960,113961,113962,113963,113965,113966,113967,113969,113970,113972,113973,113974,113977,113978,113979,113980,113981,113983,113984,113986,113988,113989,113990,113992,113993,113995,113996,113997,113998,113999,114000,130501,130502,130503,130504,130505,130506,130507,130508,130509,130510,130511,130512,130513,130514,130515,130516,130517,130518,130519,130520,130521,130522,130523,130524,130525,130526,130527,130528,130529,130530,130531,130532,130533,130534,130535,130536,130537,130538,130539,130540,130541,130542,130543,130544,130545,130546,130547,130548,130549,130550,130551,130552,130553,130554,130555,130556,130557,130558,130559,130560,130561,130562,130563,130564,130565,130566,130567,130568,130569,130570,130571,130572,130573,130574,130575,130576,130577,130578,130579,130580,130581,130582,130583,130584,130585,130586,130587,130588,130589,130590,130591,130592,130593,130594,130595,130596,130597,130598,130599,130600,130601,130602,130603,130604,130605,130606,130607,130608,130609,130610,130611,130612,130613,130614,130615,130616,130617,130618,130619,130620,130621,130622,130623,130624,130625,130626,130627,130628,130629,130630,130631,130632,130633,130634,130635,130636,130637,130638,130639,130640,130641,130642,130643,130644,130645,130646,130647,130648,130649,130650,130651,130652,130653,130654,130655,130656,130657,130658,130659,130660,130661,130662,130663,130664,130665,130666,130667,130668,130669,130670,130671,130672,130673,130674,130675,130676,130677,130678,130679,130680,130681,130682,130683,130684,130685,130686,130687,130688,130689,130690,130691,130692,130693,130694,130695,130696,130697,130698,130699,130700,130701,130702,130703,130704,130705,130706,130707,130708,130709,130710,130711,130712,130713,130714,130715,130716,130717,130718,130719,130720,130721,130722,130723,130724,130725,130726,130727,130728,130729,130730,130731,130732,130733,130734,130735,130736,130737,130738,130739,130740,130741,130742,130743,130744,130745,130746,130747,130748,130749,130750,130751,130752,130753,130754,130755,130756,130757,130758,130759,130760,130761,130762,130763,130764,130765,130766,130767,130768,130769,130770,130771,130772,130773,130774,130775,130776,130777,130778,130779,130780,130781,130782,130783,130784,130785,130786,130787,130788,130789,130790,130791,130792,130793,130794,130795,130796,130797,130798,130799,130800,130801,130802,130803,130804,130805,130806,130807,130808,130809,130810,130811,130812,130813,130814,130815,130816,130817,130818,130819,130820,130821,130822,130823,130824,130825,130826,130827,130828,130829,130830,130831,130832,130833,130834,130835,130836,130837,130838,130839,130840,130841,130842,130843,130844,130845,130846,130847,130848,130849,130850,130851,130852,130853,130854,130855,130856,130857,130858,130859,130860,130861,130862,130863,130864,130865,130866,130867,130868,130869,130870,130871,130872,130873,130874,130875,130876,130877,130878,130879,130880,130881,130882,130883,130884,130885,130886,130887,130888,130889,130890,130891,130892,130893,130894,130895,130896,130897,130898,130899,130900,130901,130902,130903,130904,130905,130906,130907,130908,130909,130910,130911,130912,130913,130914,130915,130916,130917,130918,130919,130920,130921,130922,130923,130924,130925,130926,130927,130928,130929,130930,130931,130932,130933,130934,130935,130936,130937,130938,130939,130940,130941,130942,130943,130944,130945,130946,130947,130948,130949,130950,130951,130952,130953,130954,130955,130956,130957,130958,130959,130960,130961,130962,130963,130964,130965,130966,130967,130968,130969,130970,130971,130972,130973,130974,130975,130976,130977,130978,130979,130980,130981,130982,130983,130984,130985,130986,130987,130988,130989,130990,130991,130992,130993,130994,130995,130996,130997,130998,130999,131000]

const cuentas480Saldo = [110401,110402,110403,110404,110405,110406,110407,110408,110409,110410,110411,110412,110413,110414,110415,110416,110417,110418,110419,110420,110421,110422,110423,110424,110425,110426,110427,110428,110429,110430,110431,110432,110433,110434,110435,110436,110437,110438,110439,110440,110441,110442,110443,110444,110445,110446,110447,110448,110449,110450,110451,110452,110453,110454,110455,110456,110457,110458,110459,110460,110461,110462,110463,110464,110465,110466,110467,110468,110469,110470,110471,110472,110473,110474,110475,110476,110477,110478,110479,110480,110481,110482,110483,110484,110485,110486,110487,110488,110489,110490,110491,110492,110493,110494,110495,110496,110497,110498,110500,111701,111702,111703,111704,111705,111706,111708,111709,111710,111711,111712,111713,111714,111715,111716,111717,111718,111719,111720,111721,111722,111723,111724,111725,111726,111727,111728,111729,111730,111731,111732,111733,111736,111737,111739,111740,111741,111742,111743,111744,111745,111746,111747,111748,111749,111751,111752,111754,111755,111756,111757,111758,111759,111760,111761,111762,111763,111764,111765,111766,111767,111768,111769,111770,111771,111772,111775,111776,111777,111778,111779,111780,111781,111782,111783,111784,111785,111786,111787,111788,111790,111791,111793,111794,111797,111798,111800,111802,111803,111805,111807,111808,111809,111811,111812,111813,111814,111815,111816,111817,111820,111821,111822,111824,111825,111826,111827,111829,111830,111831,111832,111835,111836,111837,111838,111839,111841,111842,111844,111845,111846,111847,111848,111849,111850,111851,111853,111854,111857,111860,111861,111863,111864,111865,111866,111867,111869,111870,111871,111872,111873,111874,111875,111876,111877,111878,111879,111880,111882,111883,111884,111886,111887,111888,111889,111890,111891,111892,111893,111894,111895,111896,111897,111898,111900,111901,111902,111903,111904,111906,111908,111909,111910,111911,111913,111914,111915,111916,111917,111918,111919,111920,111921,111923,111924,111926,111927,111928,111929,111931,111932,111933,111936,111937,111938,111939,111940,111943,111945,111946,111947,111948,111949,111950,111951,111952,111953,111955,111956,111957,111958,111960,111961,111962,111963,111964,111965,111966,111967,111968,111970,111971,111973,111974,111975,111976,111977,111978,111979,111982,111983,111986,111987,111988,111992,111994,111995,111996,111997,111999,112000,113201,113202,113203,113204,113205,113206,113207,113208,113209,113210,113211,113212,113213,113214,113215,113216,113217,113218,113219,113220,113221,113222,113223,113224,113225,113226,113227,113228,113229,113230,113231,113232,113233,113234,113235,113236,113237,113238,113239,113240,113241,113242,113243,113244,113245,113246,113247,113248,113249,113250,113251,113252,113253,113254,113255,113256,113257,113258,113259,113260,113261,113262,113263,113264,113265,113266,113267,113268,113269,113270,113271,113272,113273,113274,113275,113276,113277,113278,113279,113280,113281,113282,113283,113284,113285,113286,113287,113288,113289,113290,113291,113292,113293,113294,113295,113296,113297,113298,113299,113300,113600,113602,113603,113605,113606,113607,113608,113610,113611,113612,113613,113615,113617,113618,113621,113624,113626,113627,113628,113629,113631,113632,113633,113634,113635,113637,113639,113640,113641,113642,113643,113644,113645,113646,113647,113649,113650,113652,113653,113654,113656,113657,113658,113659,113660,113661,113662,113663,113665,113666,113667,113668,113669,113670,113672,113674,113675,113676,113677,113679,113680,113681,113682,113683,113684,113685,113686,113687,113688,113689,113690,113691,113692,113696,113699,113700, 131251,131252,131253,131254,131255,131256,131257,131258,131259,131260,131261,131262,131263,131264,131265,131266,131267,131268,131269,131270,131271,131272,131273,131274,131275,131276,131277,131278,131279,131280,131281,131282,131283,131284,131285,131286,131287,131288,131289,131290,131291,131292,131293,131294,131295,131296,131297,131298,131299,131300,131301,131302,131303,131304,131305,131306,131307,131308,131309,131310,131311,131312,131313,131314,131315,131316,131317,131318,131319,131320,131321,131322,131323,131324,131325,131326,131327,131328,131329,131330,131331,131332,131333,131334,131335,131336,131337,131338,131339,131340,131341,131342,131343,131344,131345,131346,131347,131348,131349,131350,131351,131352,131353,131354,131355,131356,131357,131358,131359,131360,131361,131362,131363,131364,131365,131366,131367,131368,131369,131370,131371,131372,131373,131374,131375,131376,131377,131378,131379,131380,131381,131382,131383,131384,131385,131386,131387,131388,131389,131390,131391,131392,131393,131394,131395,131396,131397,131398,131399,131400,131401,131402,131403,131404,131405,131406,131407,131408,131409,131410,131411,131412,131413,131414,131415,131416,131417,131418,131419,131420,131421,131422,131423,131424,131425,131426,131427,131428,131429,131430,131431,131432,131433,131434,131435,131436,131437,131438,131439,131440,131441,131442,131443,131444,131445,131446,131447,131448,131449,131450,131451,131452,131453,131454,131455,131456,131457,131458,131459,131460,131461,131462,131463,131464,131465,131466,131467,131468,131469,131470,131471,131472,131473,131474,131475,131476,131477,131478,131479,131480,131481,131482,131483,131484,131485,131486,131487,131488,131489,131490,131491,131492,131493,131494,131495,131496,131497,131498,131499,131500]

async function insertaSucursalCuenta(){
  try{
    // BUSCAMOS LA INFORMACION DE LAS CUENTAS:
    let sqlCuentas = `SELECT * FROM cuenta WHERE numero IN (131115,131118,131166,131418,131427,110146);`
    let resultCuentas = await ConsultaLibre.consulta(sqlCuentas)
    let contador = 0
    let cuentaActualiza80 = 0
    let cuentaActualiza180 = 0
    for(let cuenta of resultCuentas){
      // PRIMERO VEMOS SI LA CUENTA EXISTE EN LA SUCURSAL 672
      let sqlSucursalCuenta = `SELECT numero FROM sucursal_cuenta WHERE id_sucursal = 672 AND numero = '${cuenta.numero}';`
      let resultSucursalCuenta = await ConsultaLibre.consulta(sqlSucursalCuenta)
      if(resultSucursalCuenta.length === 0){
        //insertamos la cuenta en la sucursal
        let agregaCuentaSucursal = await OfficeAccount.addOfficeAccount({id_sucursal:672, cuenta: cuenta.numero})        
      }
      // vemos si la cuenta está en los 80 o en los 180
      let puntos = 0
      let concepto = ''
      if(cuentas80Saldo.includes(Number(cuenta.numero))){
        puntos = 80
        concepto = '80'
      }
      if(cuentas180Saldo.includes(Number(cuenta.numero))){
        puntos = 180
        concepto = '180'
      }
      if(cuentas480Saldo.includes(Number(cuenta.numero))){
        puntos = 480
        concepto = '480'
      }
      if(puntos === 80 || puntos === 180 || puntos === 480){
        // insertamos la transaccion
        let dataTransaction = {
          id_usuario: 120364,
          id_sucursal: 672,
          cuenta: cuenta.numero,
          puntos: puntos,
          referencia: 'PRECARGA',
          concepto: concepto,
          total: puntos
        }
        let transaction_id = await Transaction.createTransaction(dataTransaction)
        // insertamos en transaccion detalle
        let transactionDetail = {
          id_transaccion: transaction_id.insertId,
          id_punto: 561,
          concepto: 'Precarga 100%',
          referencia: '',
          puntos: puntos,
          porcentaje: 1,
          vigencia: null,
          total: puntos,
          id_cupon_serie: null
        }
        let altaTransaccionCuenta = await TransactionDetail.createTransactionDetail(transactionDetail)
        if(puntos === 80){
          cuentaActualiza80++
        }else{
          cuentaActualiza180++
        }
      }
      contador++
      console.log(contador)
    }
    console.log(`Cuentas actualizadas con 80: ${cuentaActualiza80}; cuentas actualizadas con 180: ${cuentaActualiza180}; Cuentas actualizadas con 480: ${cuentaActualiza480}; total de cuentas revisadas: ${contador}`)
  }catch(err){
    return err
  }
}

let resultado = insertaSucursalCuenta()
console.log(resultado)